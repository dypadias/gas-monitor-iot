@using GasMonitor.App.Models

@if (Dicas.Any())
{
    <div class="card border-0 shadow-sm mb-4 bg-white">
        <div class="card-body">
            <h5 class="card-title d-flex align-items-center text-primary">
                <span class="oi oi-lightbulb me-2"></span> Dicas Inteligentes
            </h5>
            
            <div class="list-group list-group-flush mt-3">
                @foreach (var dica in Dicas)
                {
                    <div class="list-group-item border-0 px-0 d-flex">
                        <span class="me-3 text-warning">üí°</span>
                        <span class="text-muted">@dica</span>
                    </div>
                }
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public EstatisticasResponse? Stats { get; set; }
    [Parameter] public MedicaoResponse? UltimaLeitura { get; set; }

    private List<string> Dicas = new();

    // Sempre que os par√¢metros mudarem (novos dados), recalcula as dicas
    protected override void OnParametersSet()
    {
        GerarDicas();
    }

    private void GerarDicas()
    {
        Dicas.Clear();

        if (Stats == null || UltimaLeitura == null) return;

        // 1. An√°lise de Fuga Lenta
        // Se o consumo m√©dio subiu muito de repente (ex: > 500g/dia √© muito para casa)
        if (Stats.MediaConsumoDiarioKg > 0.5)
        {
            Dicas.Add("O seu consumo di√°rio est√° muito acima da m√©dia (0.5kg/dia). Verifique se h√° micro-vazamentos ou se o forno tem sido muito usado.");
        }

        // 2. An√°lise de Turno
        if (Stats.ConsumoNoiteKg > (Stats.ConsumoDiaKg * 1.5))
        {
            Dicas.Add("A maior parte do seu consumo √© noturno. Cozinhar em grandes quantidades ao fim de semana (Meal Prep) pode economizar at√© 15% de g√°s.");
        }

        // 3. An√°lise de Press√£o/Efici√™ncia (Fim do Botij√£o)
        if (UltimaLeitura.PorcentagemGas < 10)
        {
            Dicas.Add("O g√°s est√° no fim. A chama pode ficar amarela (incompleta) e sujar as panelas. Considere trocar antes de chegar a 0% para evitar desperd√≠cio t√©rmico.");
        }

        // 4. Dica Gen√©rica de Panela (Sempre √∫til)
        // Adiciona aleatoriamente para dar variedade
        if (new Random().Next(0, 2) == 0) 
        {
            Dicas.Add("Sabia que usar a tampa nas panelas reduz o tempo de cozimento e economiza at√© 30% de g√°s?");
        }
        else
        {
             Dicas.Add("A chama do fog√£o deve ser azul. Se estiver amarela, os bicos est√£o sujos e voc√™ est√° a 'deitar dinheiro fora'.");
        }
        
        // 5. Previs√£o Financeira
        if (UltimaLeitura.DiasRestantesEstimados > 0 && UltimaLeitura.DiasRestantesEstimados < 5)
        {
             Dicas.Add($"Prepare a carteira! Pela m√©dia atual, voc√™ precisar√° comprar um botij√£o novo em cerca de {UltimaLeitura.DiasRestantesEstimados} dias.");
        }
    }
}