@using GasMonitor.App.Models

@if (Dicas.Any())
{
    <div class="card-moderno mb-4">
        <h5 class="d-flex align-items-center text-primary mb-3" style="font-weight: 700;">
            <span class="me-2">üí°</span> Dicas Inteligentes
        </h5>
        
        <div class="d-flex flex-column gap-3">
            @foreach (var dica in Dicas)
            {
                <div class="d-flex align-items-start">
                    <span class="me-3 text-warning fs-5" style="line-height: 1.2;">‚ö°</span>
                    <span class="text-muted" style="font-size: 0.95rem;">@dica</span>
                </div>
            }
        </div>
    </div>
}

@code {
    [Parameter] public EstatisticasResponse? Stats { get; set; }
    [Parameter] public MedicaoResponse? UltimaLeitura { get; set; }

    private List<string> Dicas = new();

    protected override void OnParametersSet()
    {
        GerarDicas();
    }

    private void GerarDicas()
    {
        Dicas.Clear();

        if (Stats == null || UltimaLeitura == null) return;

        // 1. An√°lise de Fuga Lenta
        if (Stats.MediaConsumoDiarioKg > 0.5)
        {
            Dicas.Add("O seu consumo di√°rio est√° muito acima da m√©dia (0.5kg/dia). Verifique se h√° micro-vazamentos ou se o forno tem sido muito usado.");
        }

        // 2. An√°lise de Turno
        if (Stats.ConsumoNoiteKg > (Stats.ConsumoDiaKg * 1.5))
        {
            Dicas.Add("A maior parte do seu consumo √© noturno. Cozinhar em grandes quantidades ao fim de semana (Meal Prep) pode economizar at√© 15% de g√°s.");
        }

        // 3. An√°lise de Fim do Botij√£o
        if (UltimaLeitura.PorcentagemGas < 10)
        {
            Dicas.Add("O g√°s est√° no fim. A chama pode ficar amarela e sujar as panelas. Considere trocar antes de chegar a 0%.");
        }

        // 4. Dica do Momento (Corre√ß√£o: Removi a l√¢mpada do texto aqui)
        var curiosidades = new List<string>
        {
            "Sabia que usar a tampa nas panelas reduz o tempo de cozimento e economiza at√© 30% de g√°s?",
            "A chama do fog√£o deve ser azul. Se estiver amarela, os bicos est√£o sujos e voc√™ est√° a gastar mais.",
            "Panelas de press√£o cozinham at√© 70% mais r√°pido que panelas comuns.",
            "Corte os alimentos em peda√ßos menores para cozinharem mais r√°pido.",
            "O fundo da panela deve cobrir toda a chama. Chama sobrando nas laterais √© dinheiro perdido."
        };

        var indiceDoDia = DateTime.Now.Hour % curiosidades.Count;
        // CORRIGIDO: Removido o emoji "üí°" daqui para n√£o duplicar
        Dicas.Add("Dica do Momento: " + curiosidades[indiceDoDia]);
        
        // 5. Previs√£o Financeira
        if (UltimaLeitura.DiasRestantesEstimados > 0 && UltimaLeitura.DiasRestantesEstimados < 5)
        {
             Dicas.Add($"Aten√ß√£o: Pela m√©dia atual, voc√™ precisar√° comprar um botij√£o novo em cerca de {UltimaLeitura.DiasRestantesEstimados} dias.");
        }
    }
}